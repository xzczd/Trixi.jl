<!DOCTYPE html><HTML lang="en"><head><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Parallelization · Trixi.jl</title><link href="https://trixi-framework.github.io/Trixi.jl/stable/parallelization/" rel="canonical"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script data-main="../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" data-theme-name="documenter-dark" data-theme-primary-dark="" href="../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/><script data-outdated-warner="">function maybeAddWarning () {
    const head = document.getElementsByTagName('head')[0];

    // Add a noindex meta tag (unless one exists) so that search engines don't index this version of the docs.
    if (document.body.querySelector('meta[name="robots"]') === null) {
        const meta = document.createElement('meta');
        meta.name = 'robots';
        meta.content = 'noindex';

        head.appendChild(meta);
    };

    // Add a stylesheet to avoid inline styling
    const style = document.createElement('style');
    style.type = 'text/css';
    style.appendChild(document.createTextNode('.outdated-warning-overlay {  position: fixed;  top: 0;  left: 0;  right: 0;  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);  z-index: 999;  background-color: #ffaba7;  color: rgba(0, 0, 0, 0.7);  border-bottom: 3px solid #da0b00;  padding: 10px 35px;  text-align: center;  font-size: 15px; }  .outdated-warning-overlay .outdated-warning-closer {    position: absolute;    top: calc(50% - 10px);    right: 18px;    cursor: pointer;    width: 12px; }  .outdated-warning-overlay a {    color: #2e63b8; }    .outdated-warning-overlay a:hover {      color: #363636; }'));
    head.appendChild(style);

    const div = document.createElement('div');
    div.classList.add('outdated-warning-overlay');
    const closer = document.createElement('div');
    closer.classList.add('outdated-warning-closer');

    // Icon by font-awesome (license: https://fontawesome.com/license, link: https://fontawesome.com/icons/times?style=solid)
    closer.innerHTML = '<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg>';
    closer.addEventListener('click', function () {
        document.body.removeChild(div);
    });
    let href = '/stable';
    if (window.documenterBaseURL) {
        href = window.documenterBaseURL + '/../stable';
    }
    div.innerHTML = 'This is an old version of the documentation. <br> <a href="' + href + '">Go to the newest version</a>.';
    div.appendChild(closer);
    document.body.appendChild(div);
};

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', maybeAddWarning);
} else {
    maybeAddWarning();
};
</script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img alt="Trixi.jl logo" src="../assets/logo.png"/></a><div class="docs-package-name"><span class="docs-autofit">Trixi.jl</span></div><form action="../search/" class="docs-search"><input class="docs-search-query" id="documenter-search-query" name="q" placeholder="Search docs" type="text"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../visualization/">Visualization</a></li><li><a class="tocitem" href="../conventions/">Conventions</a></li><li><a class="tocitem" href="../time_integration/">Time integration</a></li><li><a class="tocitem" href="../development/">Development</a></li><li><a class="tocitem" href="../performance/">Performance</a></li><li class="is-active"><a class="tocitem" href="">Parallelization</a><ul class="internal"><li><a class="tocitem" href="#Shared-memory-parallelization-with-threads"><span>Shared-memory parallelization with threads</span></a></li><li><a class="tocitem" href="#Distributed-computing-with-MPI"><span>Distributed computing with MPI</span></a></li></ul></li><li><a class="tocitem" href="../testing/">Testing</a></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../styleguide/">Style guide</a></li><li><a class="tocitem" href="../github-git/">GitHub &amp; Git</a></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../reference-trixi/">Trixi.jl</a></li><li><a class="tocitem" href="../reference-trixi2vtk/">Trixi2Vtk.jl</a></li><li><a class="tocitem" href="../reference-trixi2img/">Trixi2Img.jl</a></li></ul></li><li><a class="tocitem" href="../authors/">Authors</a></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="">Parallelization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">Parallelization</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/trixi-framework/Trixi.jl/blob/master/docs/src/parallelization.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a></div></header><article class="content" id="documenter-page"><h1 id="Parallelization"><a class="docs-heading-anchor" href="#Parallelization">Parallelization</a><a id="Parallelization-1"></a><a class="docs-heading-anchor-permalink" href="#Parallelization" title="Permalink"></a></h1><h2 id="Shared-memory-parallelization-with-threads"><a class="docs-heading-anchor" href="#Shared-memory-parallelization-with-threads">Shared-memory parallelization with threads</a><a id="Shared-memory-parallelization-with-threads-1"></a><a class="docs-heading-anchor-permalink" href="#Shared-memory-parallelization-with-threads" title="Permalink"></a></h2><p>Many compute-intensive loops in Trixi.jl are parallelized using the <a href="https://docs.julialang.org/en/v1/manual/multi-threading/">multi-threading</a> support provided by Julia. You can recognize those loops by the <code>Threads.@threads</code> macro prefixed to them, e.g.,</p><pre><code class="language-julia">Threads.@threads for element in eachelement(dg, cache)
  ...
end</code></pre><p>This will statically assign an equal iteration count to each available thread.</p><p>To use multi-threading, you need to tell Julia at startup how many threads you want to use by either setting the environment variable <code>JULIA_NUM_THREADS</code> or by providing the <code>-t/--threads</code> command line argument. For example, to start Julia with four threads, start Julia with</p><pre><code class="language-bash">julia --threads=4</code></pre><p>If both the environment variable and the command line argument are specified at the same time, the latter takes precedence.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Not everything is parallelized yet and there are likely opportunities to improve scalability. Multi-threading isn't considered part of the public API of Trixi yet.</p></div></div><h2 id="Distributed-computing-with-MPI"><a class="docs-heading-anchor" href="#Distributed-computing-with-MPI">Distributed computing with MPI</a><a id="Distributed-computing-with-MPI-1"></a><a class="docs-heading-anchor-permalink" href="#Distributed-computing-with-MPI" title="Permalink"></a></h2><p>In addition to the shared memory parallelization with multi-threading, Trixi.jl supports distributed parallelism via <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a>, which leverages the Message Passing Interface (MPI). MPI.jl comes with its own MPI library binaries such that there is no need to install MPI yourself. However, it is also possible to instead use an existing MPI installation, which is recommended if you are running MPI programs on a cluster or supercomputer (<a href="https://juliaparallel.github.io/MPI.jl/stable/configuration/">see the MPI.jl docs</a> to find out how to select the employed MPI library).</p><div class="admonition is-warning"><header class="admonition-header">Work in progress</header><div class="admonition-body"><p>MPI-based parallelization is work in progress and not finished yet. Nothing related to MPI is part of the official API of Trixi yet.</p></div></div><p>To start Trixi in parallel with MPI, there are three options:</p><ol><li><p><strong>Run from the REPL with <code>mpiexec()</code>:</strong> You can start a parallel execution directly from the REPL by executing</p><pre><code class="language-julia">julia&gt; using MPI

julia&gt; mpiexec() do cmd
         run(`$cmd -n 3 $(Base.julia_cmd()) --threads=1 --project=@. -e 'using Trixi; trixi_include(default_example())'`)
       end</code></pre><p>The parameter <code>-n 3</code> specifies that Trixi should run with three processes (or <em>ranks</em> in MPI parlance) and should be adapted to your available computing resources and problem size. The <code>$(Base.julia_cmd())</code> argument ensures that Julia is executed in parallel with the same optimization level etc. as you used for the REPL; if this is unnecessary or undesired, you can also just use <code>julia</code>.  Further, if you are not running Trixi from a local clone but have installed it as a package, you need to omit the <code>--project=@.</code>.</p></li><li><p><strong>Run from the command line with <code>mpiexecjl</code>:</strong> Alternatively, you can use the <code>mpiexecjl</code> script provided by MPI.jl, which allows you to start Trixi in parallel directly from the command line. As a preparation, you need to install the script <em>once</em> by running</p><pre><code class="language-julia">julia&gt; using MPI

julia&gt; MPI.install_mpiexecjl(destdir="/somewhere/in/your/PATH")</code></pre><p>Then, to execute Trixi in parallel, execute the following command from your command line:</p><pre><code class="language-bash">mpiexecjl -n 3 julia --threads=1 --project=@. -e 'using Trixi; trixi_include(default_example())'</code></pre></li><li><p><strong>Run interactively with <code>tmpi</code> (Linux/MacOS only):</strong> If you are on a Linux/macOS system, you have a third option which lets you run Julia in parallel interactively from the REPL. This comes in handy especially during development, as in contrast to the first two options, it allows to reuse the compilation cache and thus facilitates much faster startup times after the first execution. It requires <a href="https://github.com/tmux/tmux">tmux</a> and the <a href="https://www.open-mpi.org">OpenMPI</a> library to be installed before, both of which are usually available through a package manager. Once you have installed both tools, you need to configure MPI.jl to use the OpenMPI for your system, which is explained <a href="https://juliaparallel.github.io/MPI.jl/stable/configuration/#Using-a-system-provided-MPI">here</a>. Then, you can download and install the <a href="https://github.com/Azrael3000/tmpi">tmpi</a> script by executing</p><pre><code class="language-bash">curl https://raw.githubusercontent.com/Azrael3000/tmpi/master/tmpi -o /somewhere/in/your/PATH/tmpi</code></pre><p>Finally, you can start and control multiple Julia REPLs simultaneously by running</p><pre><code class="language-bash">tmpi 3 julia --threads=1 --project=@.</code></pre><p>This will start Julia inside <code>tmux</code> three times and multiplexes all commands you enter in one REPL to all other REPLs (try for yourself to understand what it means). If you have no prior experience with <code>tmux</code>, handling the REPL this way feels slightly weird in the beginning. However, there is a lot of documentation for <code>tmux</code><a href="https://github.com/tmux/tmux/wiki/Getting-Started">available</a> and once you get the hang of it, developing Trixi in parallel becomes much smoother this way.</p></li></ol><div class="admonition is-info"><header class="admonition-header">Hybrid parallelism</header><div class="admonition-body"><p>It is possible to combine MPI with shared memory parallelism via threads by starting Julia with more than one thread, e.g. by passing the command line argument <code>julia --threads=2</code> instead of <code>julia --threads=1</code> used in the examples above. In that case, you should make sure that your system supports the number of processes/threads that you try to start.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../performance/">« Performance</a><a class="docs-footer-nextpage" href="../testing/">Testing »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 14 January 2021 11:12">Thursday 14 January 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>